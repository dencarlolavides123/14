<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Heart's Message üíå</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ---------- CSS VARIABLES ---------- */
:root {
    --primary: #FF6B81;
    --primary-light: #FFB3C1;
    --secondary: #2EC4B6;
    --secondary-light: #B7F1EA;
    --accent: #FFE9EE;
    --dark: #0F1115;
    --light: #F9FBFF;
    --gray: #6C757D;
    --success: #4CC9F0;
    --shadow-sm: 0 4px 6px rgba(0,0,0,0.07);
    --shadow-md: 0 10px 25px rgba(0,0,0,0.15);
    --shadow-lg: 0 20px 50px rgba(0,0,0,0.2);
    --radius-sm: 12px;
    --radius-md: 20px;
    --radius-lg: 30px;
    --transition: all 0.4s cubic-bezier(0.175,0.885,0.32,1.1);
    --font-sans: 'Sora', 'Segoe UI', sans-serif;
    --font-serif: 'Sora', 'Segoe UI', sans-serif;
    --font-script: 'Sora', 'Segoe UI', sans-serif;
    --glass-bg: rgba(255, 255, 255, 0.08);
    --glass-border: rgba(255, 255, 255, 0.18);
    --glass-strong: rgba(255, 255, 255, 0.12);
}

/* Theme variations */
:root.theme-pastel {
    --primary: #FF6B9D;
    --secondary: #C44569;
    --accent: #FFC0CB;
}

:root.theme-dark {
    --dark: #0F0F0F;
    --light: #F5F5F5;
}

/* ---------- BASE STYLES ---------- */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:var(--font-sans);background:
radial-gradient(circle at 20% 10%, rgba(255,107,129,0.25), transparent 38%),
radial-gradient(circle at 80% 90%, rgba(46,196,182,0.22), transparent 40%),
linear-gradient(135deg,#0E1015 0%,#101522 55%,#0E1015 100%);
color:var(--light);min-height:100vh;min-height:calc(var(--vh, 1vh) * 100);overflow-x:hidden;position:relative;animation:backgroundShift 18s ease infinite;}
body::before{content:'';position:fixed;inset:-20% -10%;background:
radial-gradient(circle at 18% 22%,rgba(255,179,193,0.12) 0%,transparent 36%),
radial-gradient(circle at 82% 28%,rgba(183,241,234,0.12) 0%,transparent 36%);
pointer-events:none;z-index:-2;animation:gradientShift 20s ease-in-out infinite;}
body::after{content:'';position:fixed;inset:0;background:
    linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px),
    linear-gradient(0deg, rgba(255,255,255,0.025) 1px, transparent 1px);
background-size: 48px 48px;
pointer-events:none;z-index:-1;opacity:0.35;}

/* ---------- LOADING SCREEN ---------- */
.loading-screen{position:fixed;inset:0;background:linear-gradient(135deg,#0F1115 0%,#151822 100%);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000;transition:opacity 0.8s ease,visibility 0.8s ease;}
.loading-screen.hidden{opacity:0;visibility:hidden;}
.loader{width:80px;height:80px;position:relative;margin-bottom:2rem;}
.loader-heart{position:absolute;width:100%;height:100%;animation:pulse 2s ease-in-out infinite;color:var(--primary);}
.loader-text{font-size:1.1rem;font-weight:300;letter-spacing:3px;color:rgba(255,255,255,0.7);text-align:center;}
@keyframes pulse{0%,100%{transform:scale(1);opacity:1;}50%{transform:scale(1.1);opacity:0.7;}}
@keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}

/* ---------- AUTH SCREEN ---------- */
.auth-screen{display:none;align-items:center;justify-content:center;height:calc(var(--vh, 1vh) * 100);min-height:0;padding:2.4rem;opacity:0;animation:fadeIn 0.6s ease forwards;position:relative;isolation:isolate;}
.auth-screen::before{content:'';position:absolute;inset:0;background:
    radial-gradient(circle at 14% 20%, rgba(255,107,129,0.18), transparent 40%),
    radial-gradient(circle at 90% 15%, rgba(46,196,182,0.16), transparent 38%),
    linear-gradient(120deg, rgba(255,255,255,0.04), transparent 60%);z-index:-2;}
.auth-screen::after{content:'';position:absolute;inset:-20%;background:
    radial-gradient(circle at 30% 70%, rgba(255,179,193,0.18), transparent 45%),
    radial-gradient(circle at 70% 70%, rgba(183,241,234,0.12), transparent 45%);filter:blur(10px);opacity:0.8;z-index:-1;}

.auth-shell{width:min(960px, 100%);display:grid;grid-template-columns:1.05fr 0.95fr;gap:2.2rem;background:rgba(10,12,18,0.6);border:1px solid rgba(255,255,255,0.12);border-radius:28px;backdrop-filter:blur(22px);box-shadow:0 30px 70px rgba(6,8,12,0.6);overflow:hidden;}
.auth-hero{padding:3rem 3.1rem;position:relative;display:flex;flex-direction:column;gap:1.2rem;min-height:360px;}
.auth-kicker{display:inline-flex;align-items:center;gap:0.55rem;font-size:0.8rem;letter-spacing:0.28rem;text-transform:uppercase;font-weight:700;color:rgba(255,255,255,0.7);}
.auth-kicker i{color:var(--primary);}
.auth-headline{font-size:2.6rem;line-height:1.1;font-weight:800;color:var(--light);}
.auth-copy{color:rgba(255,255,255,0.72);font-size:1rem;line-height:1.65;max-width:28ch;}
.auth-meta{display:grid;gap:0.7rem;margin-top:auto;}
.auth-meta-item{display:flex;align-items:center;gap:0.75rem;padding:0.6rem 0.9rem;border-radius:14px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);font-size:0.95rem;color:rgba(255,255,255,0.8);}
.auth-meta-item i{color:var(--secondary);}
.auth-orbit{position:absolute;right:-40px;bottom:-40px;width:200px;height:200px;border-radius:50%;border:1px dashed rgba(255,255,255,0.2);animation:spin 18s linear infinite;}
.auth-orbit::before{content:'';position:absolute;top:16px;left:12px;width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));box-shadow:0 10px 30px rgba(255,107,129,0.45);}
.auth-orbit::after{content:'';position:absolute;bottom:20px;right:24px;width:18px;height:18px;border-radius:50%;background:rgba(255,255,255,0.8);}

.auth-form{padding:3rem 2.6rem;display:flex;flex-direction:column;gap:1.4rem;background:rgba(12,15,22,0.85);border-left:1px solid rgba(255,255,255,0.08);}
.auth-form-title{font-size:1.4rem;font-weight:700;color:var(--light);}
.auth-form-sub{font-size:0.95rem;color:rgba(255,255,255,0.65);}
.input-group{position:relative;margin-top:0.4rem;}
.input-label{display:block;font-size:0.85rem;text-transform:uppercase;letter-spacing:0.18rem;color:rgba(255,255,255,0.55);margin-bottom:0.6rem;}
.input-wrap{display:flex;align-items:center;gap:0.8rem;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.18);border-radius:16px;padding:0.4rem 1rem;}
.input-wrap i{color:rgba(255,255,255,0.7);}
.pass-input{flex:1;width:100%;padding:0.85rem 0;background:transparent;border:none;font-size:1.25rem;font-weight:600;color:var(--light);text-align:left;letter-spacing:0.45rem;outline:none;}
.pass-input:focus{outline:none;}
.input-wrap:focus-within{border-color:rgba(255,255,255,0.45);box-shadow:0 0 0 3px rgba(255,107,129,0.18);}
.pass-input::placeholder{color:rgba(255,255,255,0.4);letter-spacing:0.2rem;font-weight:400;}
.auth-btn{width:100%;padding:1.05rem;background:linear-gradient(135deg,var(--primary) 0%, var(--secondary) 100%);color:white;border:none;border-radius:16px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.35s cubic-bezier(0.4,0,0.2,1);display:flex;align-items:center;justify-content:center;gap:0.6rem;box-shadow:0 18px 38px rgba(255,107,129,0.35);position:relative;}
.auth-btn:hover{transform:translateY(-2px);box-shadow:0 22px 44px rgba(46,196,182,0.35);}
.auth-btn:active{transform:translateY(0);}
.auth-hint{font-size:0.85rem;color:rgba(255,255,255,0.5);text-align:center;}
.error-message{color:#FFB3C6;font-size:0.95rem;min-height:1.5rem;opacity:0;transition:opacity 0.35s ease;font-weight:500;text-align:center;}
.error-message.show{opacity:1;}

/* ---------- ENVELOPE ENHANCED ---------- */
.envelope-container {
    display: none;
    justify-content: center;
    align-items: center;
    height: calc(var(--vh, 1vh) * 100);
    min-height: 0;
    padding: 2rem;
    opacity: 0;
    animation: fadeIn 0.6s ease forwards;
    position: relative;
}

/* Only show envelope when explicitly marked visible */
.envelope-container.visible {
    display: flex !important;
    opacity: 1;
    animation: none; /* avoid replaying the entrance animation when class toggles */
    transition: opacity 0.3s ease;
    z-index: 600; /* keep envelope above controls */
} 

.envelope-container::before {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(10, 8, 20, 0.08);
    backdrop-filter: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    z-index: 100;
}

body.envelope-open .envelope-container::before {
    opacity: 1;
}

.envelope-wrapper {
    perspective: 1500px;
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
}

.envelope-wrapper:hover:not(.open) {
    transform: translateY(-10px) scale(1.02);
}

.envelope {
    position: relative;
    width: min(80vw, 360px);
    height: 220px;
    margin: 0 auto;
    box-sizing: border-box;
    background: linear-gradient(135deg, rgba(18,22,32,0.95) 0%, rgba(26,32,48,0.98) 60%, rgba(18,22,32,0.95) 100%);
    border-radius: 18px;
    box-shadow: 
        0 28px 70px rgba(6, 8, 12, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    overflow: visible;
    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), box-shadow 0.6s ease;
    transform-style: preserve-3d;
}

/* Subtle paper edge to add depth */
.envelope::after {
    content: '';
    position: absolute;
    inset: 10px;
    border-radius: inherit;
    border: 1px solid rgba(255, 255, 255, 0.1);
    pointer-events: none;
}

/* Envelope flap with decorative edge */
.flap {
    display: none;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 150px;
    background: linear-gradient(135deg, rgba(26,32,48,0.95) 0%, rgba(34,42,58,0.98) 50%, rgba(23,28,40,0.95) 100%);
    clip-path: polygon(0% 0%, 50% 70%, 100% 0%);
    transform-origin: top center;
    transform: rotateX(0deg);
    transform-style: preserve-3d;
    backface-visibility: hidden;
    transition: transform 0.9s cubic-bezier(0.22, 1, 0.36, 1);
    z-index: 4;
    border-radius: 8px 8px 0 0;
    box-shadow: 
        0 5px 20px rgba(0, 0, 0, 0.2),
        inset 0 -2px 0 rgba(255, 255, 255, 0.3);
}

/* Flap decorative edge */
.flap::before {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 10%;
    right: 10%;
    height: 20px;
    background: linear-gradient(to bottom, rgba(255, 255, 255, 0.15), transparent);
    border-radius: 50%;
    filter: blur(5px);
    z-index: 1;
}

/* Envelope body with subtle pattern */
.envelope::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
        linear-gradient(135deg, rgba(255,255,255,0.04) 0%, transparent 55%),
        radial-gradient(circle at 20% 80%, rgba(255,255,255,0.03) 2px, transparent 2px);
    background-size: 36px 36px;
    border-radius: inherit;
    opacity: 0.35;
}

/* Seal sticker */
.seal {
    display: none;
    position: absolute;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #FF6B81, #2EC4B6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;
    box-shadow: 
        0 10px 24px rgba(10, 12, 18, 0.45),
        inset 0 2px 0 rgba(255, 255, 255, 0.25),
        0 0 0 4px rgba(255, 255, 255, 0.08);
    transition: var(--transition);
}

.seal-inner {
    font-size: 24px;
    color: white;
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));
}

.envelope-wrapper:hover .seal {
    transform: translate(-50%, -50%) scale(1.1);
    box-shadow: 
        0 12px 30px rgba(255, 77, 109, 0.6),
        inset 0 2px 0 rgba(255, 255, 255, 0.4);
}

/* Letter with elegant design */
.letter {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(60px);
    width: min(86vw, 440px);
    padding: 1.2rem;
    transition: all 0.9s cubic-bezier(0.34, 1.56, 0.64, 1);
    z-index: 900;
    overflow: visible;
    opacity: 0;
    pointer-events: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    background:
        linear-gradient(180deg, #FFF6F8 0%, #FFFDFE 45%, #F8FBFF 100%),
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.75) 0px, rgba(255, 255, 255, 0.75) 26px, rgba(240, 242, 248, 0.7) 27px);
    border-radius: 16px;
    box-shadow: 
        0 24px 50px rgba(10, 12, 18, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.95),
        inset 0 0 0 1px rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(15, 17, 21, 0.12);
}

/* Letter pattern overlay */
.letter::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 56px;
    background:
        linear-gradient(90deg, rgba(255,107,129,0.22), rgba(46,196,182,0.18)),
        repeating-linear-gradient(90deg, rgba(255,255,255,0.25) 0px, rgba(255,255,255,0.25) 10px, transparent 10px, transparent 20px);
    border-radius: 16px 16px 0 0;
    opacity: 0.95;
}

.letter::after {
    content: '';
    position: absolute;
    inset: 16px;
    border-radius: 12px;
    border: 1px dashed rgba(255, 107, 129, 0.25);
    pointer-events: none;
    z-index: 1;
}

/* When envelope opens */
.envelope-wrapper.open .flap {
    transform: rotateX(-180deg);
    z-index: 0;
}

.envelope-wrapper.open .letter {
    position: fixed;
    top: 50%;
    left: 50%;
    opacity: 1;
    transform: translate(-50%, -50%);
    width: min(92vw, 720px);
    height: min(70vh, 520px);
    overflow: auto;
    pointer-events: auto;
    z-index: 800;
    box-shadow: 
        0 40px 90px rgba(6, 8, 12, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

/* Letter content */
.letter-content {
    flex: 1;
    overflow-y: auto;
    padding-right: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    width: 100%;
    position: relative;
    z-index: 2;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
}

.letter-title {
    font-family: var(--font-sans);
    font-size: 1.8rem;
    color: var(--primary);
    margin-bottom: 0.5rem;
    font-weight: 800;
    line-height: 1.2;
    text-align: center;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.letter-message {
    font-size: 1.02rem;
    line-height: 1.7;
    color: #2C2F38;
    margin-bottom: 0;
    max-width: 560px;
    text-align: center;
    padding: 0 1rem;
    font-weight: 500;
}

/* Enhanced question card */
.question-zone {
    display: none;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 2px dashed rgba(255, 77, 109, 0.3);
    width: auto;
    animation: slideUp 0.6s ease-out forwards;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.question-card {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 1.6rem 1.8rem;
    box-shadow: 
        0 16px 32px rgba(10, 12, 18, 0.12),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
    width: 100%;
    border: 1px solid rgba(15, 17, 21, 0.08);
    position: relative;
    overflow: hidden;
    transition: all 0.35s ease;
}

.question-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    opacity: 0.9;
}

/* Decorative corner accents */
.question-card::before,
.question-card::after {
    content: '‚ù§Ô∏è';
    position: absolute;
    font-size: 1.2rem;
    opacity: 0.2;
}

.question-card::before {
    top: 10px;
    left: 10px;
}

.question-card::after {
    bottom: 10px;
    right: 10px;
}

.question-text {
    font-family: var(--font-sans);
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--dark);
    text-align: center;
    margin-bottom: 1.5rem;
    line-height: 1.4;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    padding: 0 1rem;
}

.button-group {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.btn {
    --btn-scale: 1;
    padding: 1rem 2rem;
    border: 1px solid rgba(255,255,255,0.5);
    border-radius: 999px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    min-width: 160px;
    position: relative;
    overflow: hidden;
    transform: translateY(0) scale(var(--btn-scale)) translateZ(0);
    backface-visibility: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s;
}

.btn:hover::before {
    left: 100%;
}

.btn-yes {
    background: linear-gradient(135deg, #FF6B81 0%, #2EC4B6 100%);
    color: white;
    box-shadow: 
        0 14px 34px rgba(255, 107, 129, 0.35),
        0 4px 0 rgba(46, 196, 182, 0.45);
}

.btn-yes:hover {
    transform: translateY(-3px) scale(calc(var(--btn-scale) * 1.05));
    box-shadow: 
        0 24px 50px rgba(255, 107, 129, 0.45),
        0 6px 0 rgba(46, 196, 182, 0.55);
}

.btn-yes:active {
    transform: translateY(-1px) scale(var(--btn-scale));
}

.btn-no {
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(245,247,250,0.95) 100%);
    color: #495057;
    box-shadow: 
        0 8px 25px rgba(108, 117, 125, 0.15),
        0 4px 0 rgba(173, 181, 189, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.6);
    
}

.btn-no:hover {
    transform: translateY(-3px) scale(var(--btn-scale));
    box-shadow: 
        0 15px 35px rgba(108, 117, 125, 0.2),
        0 6px 0 rgba(173, 181, 189, 0.5);
    background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
}

/* Glow effect for envelope when open */
.envelope-wrapper.open .envelope {
    transform: scale(0.98);
    box-shadow: 
        0 22px 60px rgba(6, 8, 12, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

@keyframes envelopeGlow {
    from {
        box-shadow: 
            0 30px 60px rgba(255, 77, 109, 0.3),
            0 0 0 1px rgba(255, 255, 255, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    to {
        box-shadow: 
            0 40px 80px rgba(255, 77, 109, 0.4),
            0 0 0 2px rgba(255, 255, 255, 0.15),
            inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }
}

/* Scrollbar styling for letter */
.letter-content::-webkit-scrollbar {
    width: 6px;
}

.letter-content::-webkit-scrollbar-track {
    background: rgba(255, 77, 109, 0.1);
    border-radius: 10px;
}

.letter-content::-webkit-scrollbar-thumb {
    background: linear-gradient(to bottom, var(--primary), var(--secondary));
    border-radius: 10px;
}

/* ---------- CELEBRATION SCREEN ---------- */
.celebration-screen{position:fixed;inset:0;background:linear-gradient(135deg,rgba(26,20,35,0.95) 0%,rgba(45,27,61,0.98) 100%);backdrop-filter:blur(5px);display:none;flex-direction:column;justify-content:center;align-items:center;z-index:100;opacity:0;animation:fadeIn 0.8s ease forwards;}
.celebration-content{text-align:center;max-width:600px;padding:2rem;}
.celebration-icon{font-size:6rem;margin-bottom:2rem;animation:bounce 2s ease infinite;color:var(--primary);}
.celebration-title{font-family:var(--font-serif);font-size:3.5rem;font-weight:800;margin-bottom:1rem;background:linear-gradient(to right,var(--primary),var(--secondary-light));-webkit-background-clip:text;background-clip:text;color:transparent;line-height:1.2;}
.celebration-photo-slideshow{width:100%;max-width:400px;height:250px;margin:1.5rem auto;border-radius:var(--radius-lg);overflow:hidden;box-shadow:0 15px 40px rgba(255,77,109,0.3);position:relative;display:none;}
.celebration-photo-slideshow.show{display:block;}
.celebration-photo-slideshow img{width:100%;height:100%;object-fit:cover;animation:slideIn 0.6s ease;}
.celebration-message{font-size:1.4rem;color:rgba(255,255,255,0.9);margin-bottom:2rem;line-height:1.6;}
.celebration-quote{font-size:1.2rem;color:var(--primary-light);font-style:italic;margin:1.5rem 0;padding:1.5rem;background:rgba(255,77,109,0.1);border-left:4px solid var(--primary);border-radius:8px;line-height:1.8;min-height:80px;animation:fadeInQuote 0.8s ease;}
.celebration-date{display:inline-block;background:rgba(255,255,255,0.1);padding:0.8rem 1.5rem;border-radius:50px;font-size:1.2rem;font-weight:600;color:var(--primary-light);margin-top:1rem;border:1px solid rgba(255,255,255,0.1);}

/* ---------- ANIMATIONS ---------- */
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-15px);}}
@keyframes pulseGlow{0%,100%{transform:scale(1);opacity:0.7;}50%{transform:scale(1.08);opacity:1;}}
@keyframes slideIn{from{opacity:0;}to{opacity:1;}}
@keyframes slideOut{from{opacity:1;transform:translateY(0);}to{opacity:0;transform:translateY(-20px);}}
@keyframes fadeInQuote{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}} 
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);}}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-10px);}75%{transform:translateX(10px);}}
.heart-particle{position:fixed;pointer-events:none;font-size:1.5rem;z-index:50;opacity:0;animation:floatUp 4s ease-out forwards;}
@keyframes floatUp{0%{transform:translateY(0) rotate(0deg);opacity:1;}100%{transform:translateY(-100vh) rotate(360deg);opacity:0;}}
.floating-heart{position:fixed;pointer-events:none;font-size:1.2rem;opacity:0.7;animation:floatAround 20s linear infinite;}
@keyframes floatAround{0%{transform:translate(0,0) rotate(0deg);}25%{transform:translate(100px,100px) rotate(90deg);}50%{transform:translate(0,200px) rotate(180deg);}75%{transform:translate(-100px,100px) rotate(270deg);}100%{transform:translate(0,0) rotate(360deg);}}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 768px) {
    .auth-card{padding:2rem;}
    .envelope-container{padding:1.5rem 1.2rem 2.5rem;}
    .envelope {
        width: min(92vw, 340px);
        height: clamp(210px, 62vw, 250px);
    }
    
    .envelope-wrapper.open .letter {
        width: min(94vw, 640px);
        height: min(72vh, 460px);
        transform: translate(-50%, -50%);
        padding: 1.2rem 1.1rem;
    }
    
    .letter-title {
        font-size: 1.6rem;
    }
    
    .letter-message {
        font-size: 1.02rem;
        line-height: 1.65;
    }
    
    .question-card {
        padding: 1.4rem;
    }
    
    .question-text {
        font-size: 1.2rem;
    }
    
    .btn {
        min-width: 140px;
        padding: 0.9rem 1.5rem;
    }
    .celebration-title{font-size:2.5rem;}
    .celebration-message{font-size:1.2rem;}
    .music-player {
        right: 1rem;
        bottom: 1rem;
        padding: 0.9rem;
        gap: 0.7rem;
    }
}


@media (max-width: 480px) {
    .auth-card{padding:1.5rem;}
    .envelope-container{padding:1.2rem 1rem 2.2rem;}
    .envelope {
        width: 92vw;
        height: clamp(200px, 62vw, 230px);
    }
    
    .envelope-wrapper.open .letter {
        width: 94vw;
        height: min(72vh, 420px);
        transform: translate(-50%, -50%);
        padding: 1rem 0.95rem;
    }
    
    .letter{padding:1.1rem;}
    .button-group {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 280px;
    }
    .question-card {
        padding: 1.1rem 1.1rem;
    }
    .letter-message {
        font-size: 0.98rem;
        padding: 0 0.4rem;
    }
    .celebration-content {
        padding: 1.2rem;
    }
    .celebration-title {
        font-size: 2.1rem;
    }
    .music-player {
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        bottom: 0.8rem;
        width: min(92vw, 360px);
        justify-content: center;
    }
}

@media (max-width: 360px) {
    .envelope {
        width: 94vw;
        height: clamp(190px, 64vw, 220px);
    }
    .envelope-wrapper.open .letter {
        width: 94vw;
        height: min(70vh, 380px);
        transform: translate(-50%, -50%);
    }
    .letter-title {
        font-size: 1.45rem;
    }
    .question-text {
        font-size: 1.1rem;
    }
}

/* ---------- MUSIC PLAYER ---------- */
.music-player {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: var(--radius-lg);
    padding: 1.2rem;
    z-index: 500;
    display: flex;
    gap: 1rem;
    align-items: center;
    box-shadow: var(--shadow-lg);
    transition: var(--transition);
}

.music-player:hover {
    background: rgba(255, 255, 255, 0.15);
}

.music-btn {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    color: white;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    font-size: 1.2rem;
}

.music-btn:hover {
    transform: scale(1.1);
}

.volume-slider {
    width: 100px;
    cursor: pointer;
    accent-color: var(--primary);
}

/* ---------- CONTROLS BAR ---------- */
.controls-bar {
    position: fixed;
    top: 50%;
    left: 1.2rem;
    right: auto;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    z-index: 400;
    flex-wrap: wrap;
    justify-content: center;
    padding: 0.7rem;
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.14);
    border-radius: 18px;
    backdrop-filter: blur(12px);
    box-shadow: 0 18px 44px rgba(8, 10, 14, 0.45);
}

.auth-open .controls-bar,
.envelope-open .controls-bar {
    top: auto;
    left: 50%;
    right: auto;
    bottom: 2.4rem;
    transform: translateX(-50%);
    flex-direction: row;
    gap: 0.6rem;
    padding: 0.6rem 0.8rem;
    max-width: min(920px, 92vw);
}

.auth-open .control-btn,
.envelope-open .control-btn {
    font-size: 0.82rem;
    padding: 0.5rem 0.7rem;
}

.approved .controls-bar {
    display: none;
}

.control-btn {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.16);
    color: #F9FBFF;
    padding: 0.55rem 0.75rem;
    border-radius: 12px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: var(--transition);
    backdrop-filter: blur(10px);
    font-weight: 600;
    white-space: nowrap;
}

.control-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

/* ---------- NAME INPUT MODAL ---------- */
.name-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.name-modal.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.name-modal-content {
    background: linear-gradient(135deg, rgba(26, 20, 35, 0.92), rgba(45, 27, 61, 0.92));
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-lg);
    padding: 2.5rem;
    text-align: center;
    max-width: 400px;
    box-shadow: var(--shadow-lg);
}

.name-modal-title {
    font-size: 1.8rem;
    color: var(--light);
    margin-bottom: 1.5rem;
    font-weight: 700;
}

.name-input {
    width: 100%;
    padding: 1rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: white;
    font-size: 1rem;
    margin-bottom: 1.5rem;
    transition: var(--transition);
}

.name-input:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.15);
}

.name-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.modal-btn {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    padding: 1rem 2rem;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-weight: 700;
    transition: var(--transition);
    width: 100%;
}

.modal-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(255, 77, 109, 0.3);
}

/* ---------- COUNTDOWN TIMER ---------- */
.countdown {
    text-align: center;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

.countdown-number {
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--primary);
}

/* ---------- LOVE COUNTER ---------- */
.love-counter {
    position: fixed;
    bottom: 1rem;
    left: 1rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1rem 1.5rem;
    border-radius: var(--radius-md);
    color: var(--primary);
    font-weight: 700;
    font-size: 1rem;
    z-index: 400;
}

/* ---------- HIDDEN MESSAGE ---------- */
.hidden-message {
    display: none;
    background: linear-gradient(135deg, rgba(255, 77, 109, 0.1), rgba(123, 44, 191, 0.1));
    border-radius: var(--radius-md);
    padding: 1.5rem;
    margin-top: 1.5rem;
    border-left: 4px solid var(--primary);
    animation: slideUp 0.6s ease-out;
}

.hidden-message.show {
    display: block;
}

.hidden-message-title {
    color: var(--primary);
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.hidden-message-text {
    color: #666;
    line-height: 1.6;
}

/* ---------- CONFETTI ---------- */
.confetti {
    position: fixed;
    pointer-events: none;
    font-size: 1.5rem;
}

@keyframes confettiFall {
    0% {
        transform: translateY(0) rotateZ(0deg);
        opacity: 1;
    }
    100% {
        transform: translateY(100vh) rotateZ(720deg);
        opacity: 0;
    }
}

.confetti {
    animation: confettiFall 3s ease-in forwards;
}

/* ---------- GLOW EFFECTS ---------- */
.btn-yes:hover {
    box-shadow: 
        0 20px 40px rgba(76, 201, 240, 0.4),
        0 6px 0 rgba(58, 134, 255, 0.5),
        0 0 30px rgba(76, 201, 240, 0.3);
}

.envelope-wrapper:hover .seal {
    filter: drop-shadow(0 0 15px rgba(255, 77, 109, 0.6));
}

/* ---------- PARALLAX ---------- */
.parallax-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0.5;
    will-change: transform;
}

/* ---------- ENHANCED SCROLLBAR ---------- */
.letter-content::-webkit-scrollbar {
    width: 8px;
}

.letter-content::-webkit-scrollbar-track {
    background: rgba(255, 77, 109, 0.1);
    border-radius: 10px;
}

.letter-content::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(255, 77, 109, 0.3);
}

.letter-content::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, var(--secondary) 0%, var(--primary) 100%);
}

/* ---------- RIPPLE EFFECT ---------- */
.ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: scale(0);
    animation: rippleEffect 0.6s ease-out;
    pointer-events: none;
}

@keyframes rippleEffect {
    0% {
        transform: scale(0);
        opacity: 1;
    }
    100% {
        transform: scale(4);
        opacity: 0;
    }
}

/* ---------- TOAST NOTIFICATIONS ---------- */
.toast-container {
    position: fixed;
    top: 1.5rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    pointer-events: none;
}

.toast {
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: var(--radius-md);
    border-left: 4px solid var(--primary);
    box-shadow: var(--shadow-lg);
    animation: slideIn 0.3s ease;
    pointer-events: auto;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ---------- LOADING BAR ---------- */
.loading-bar {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--secondary), var(--primary));
    width: 0%;
    z-index: 9999;
    animation: loading 2s ease-in-out;
}

@keyframes loading {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
}

/* ---------- CURSOR SPARKLES ---------- */
.sparkle {
    position: fixed;
    pointer-events: none;
    font-size: 1rem;
    animation: sparkleAnim 1s ease-out forwards;
}

@keyframes sparkleAnim {
    0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
    }
    100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
    }
}

/* ---------- MOBILE MENU ---------- */
.hamburger {
    display: none;
    position: fixed;
    top: 1.5rem;
    left: 1.5rem;
    flex-direction: column;
    gap: 0.4rem;
    z-index: 1000;
    background: none;
    border: none;
    cursor: pointer;
}

.hamburger span {
    width: 25px;
    height: 3px;
    background: white;
    border-radius: 2px;
    transition: var(--transition);
}

.hamburger.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
}

.hamburger.active span:nth-child(2) {
    opacity: 0;
}

.hamburger.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
}

.mobile-menu {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(26, 20, 35, 0.95);
    backdrop-filter: blur(10px);
    z-index: 999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
}

.mobile-menu.show {
    display: flex;
}

/* ---------- PHOTO GALLERY ---------- */
.gallery-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.gallery-modal.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.gallery-content {
    background: linear-gradient(135deg, rgba(26, 20, 35, 0.95), rgba(45, 27, 61, 0.95));
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-lg);
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.gallery-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
}

.gallery-upload {
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-md);
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
    margin-bottom: 1.5rem;
}

.gallery-upload:hover {
    border-color: var(--primary);
    background: rgba(255, 77, 109, 0.1);
}

.gallery-upload input[type="file"] {
    display: none;
}

.gallery-images {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 1rem;
}

.gallery-img {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: var(--transition);
}

.gallery-img:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(255, 77, 109, 0.4);
}

/* ---------- MESSAGE EDITOR ---------- */
.editor-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.editor-modal.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.editor-content {
    background: linear-gradient(135deg, rgba(26, 20, 35, 0.95), rgba(45, 27, 61, 0.95));
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-lg);
    padding: 2rem;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.editor-title {
    color: white;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
}

.editor-textarea {
    width: 100%;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    color: white;
    font-size: 1rem;
    font-family: inherit;
    resize: vertical;
    min-height: 200px;
    margin-bottom: 1rem;
    transition: var(--transition);
}

.editor-textarea:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.12);
}

/* ---------- UNDO BUTTON ---------- */
.undo-btn {
    position: fixed;
    bottom: 5.5rem;
    right: 2rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 400;
    transition: var(--transition);
    font-size: 1.2rem;
}

.undo-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: scale(1.1);
}

/* ---------- PROGRESS INDICATOR ---------- */
.progress-indicator {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 100px;
    height: 100px;
    background: conic-gradient(var(--primary) 0deg, var(--secondary) 360deg);
    border-radius: 50%;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 400;
    font-weight: 700;
    color: white;
    font-size: 1.2rem;
}

.progress-indicator-inner {
    width: 90px;
    height: 90px;
    background: linear-gradient(135deg, #1A1423 0%, #2D1B3D 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
}

.progress-percent {
    font-size: 1.5rem;
}

.progress-label {
    font-size: 0.7rem;
    opacity: 0.8;
}

/* ---------- SMOOTH TRANSITIONS ---------- */
.fade-out {
    animation: fadeOut 0.3s ease;
}

@keyframes fadeOut {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

.fade-in {
    animation: fadeIn 0.5s ease;
}

/* ---------- BUTTON PRESS EFFECT ---------- */
.btn:active {
    transform: scale(0.95);
}

/* ---------- CARD HOVER LIFT ---------- */
.question-card:hover {
    transform: translateY(-10px);
    box-shadow: 
        0 30px 60px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.9);
}

/* ---------- ANIMATED GRADIENT ---------- */
@keyframes backgroundShift {
    0%, 100% {
        filter: hue-rotate(0deg);
    }
    50% {
        filter: hue-rotate(5deg);
    }
}

@keyframes gradientShift {
    0%, 100% {
        opacity: 0.8;
    }
    50% {
        opacity: 1;
    }
}

/* ---------- MUSIC SELECTOR ---------- */
.music-selector {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.music-selector.show {
    display: flex;
    animation: fadeIn 0.3s ease;
}

.music-selector-content {
    background: linear-gradient(135deg, rgba(26, 20, 35, 0.95), rgba(45, 27, 61, 0.95));
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-lg);
    padding: 2rem;
    max-width: 400px;
    width: 90%;
}

.music-option {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: white;
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-bottom: 1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 1rem;
}

.music-option:hover {
    background: rgba(255, 255, 255, 0.12);
    border-color: var(--primary);
}

.music-option.active {
    background: rgba(255, 77, 109, 0.2);
    border-color: var(--primary);
}

/* ---------- MOBILE RESPONSIVE ---------- */
@media (max-width: 768px) {
    .hamburger {
        display: flex;
    }
    
    .controls-bar {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 1rem;
        top: auto;
        right: auto;
        flex-direction: row;
        justify-content: center;
    }
    
    .undo-btn {
        bottom: 8rem;
    }
}

/* ---------- ENHANCED MOBILE RESPONSIVE ---------- */
@media (max-width: 768px) {
    :root {
        font-size: 14px;
    }
    
    body {
        overflow-y: auto;
    }
    
    /* Auth Screen Mobile */
    .auth-shell {
        grid-template-columns: 1fr;
        gap: 0;
    }
    
    .auth-hero {
        padding: 2rem 1.8rem;
        min-height: auto;
    }
    
    .auth-headline {
        font-size: 2.1rem;
    }
    
    .auth-copy {
        max-width: none;
    }
    
    .auth-form {
        padding: 2rem 1.8rem;
        border-left: none;
        border-top: 1px solid rgba(255,255,255,0.08);
    }
    
    .pass-input {
        font-size: 1.3rem;
        letter-spacing: 0.35rem;
    }
    
    .auth-btn {
        padding: 1.1rem;
        min-height: 48px;
    }
    
    /* Envelope Container Mobile - only when visible */
    .envelope-container.visible {
        display: flex !important;
        z-index: 600; /* ensure envelope is above controls */
        padding: 0.6rem;
    }
    
    /* Envelope Mobile */
    .envelope {
        width: 100%;
        max-width: 320px;
        height: 220px;
        margin: 0 auto;
        box-sizing: border-box;
    }
    
    .envelope-wrapper {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .envelope-wrapper:hover:not(.open) {
        transform: translateY(-5px);
    }
    
    /* Letter Mobile */
    .letter {
        padding: 1.1rem;
        left: 50%;
        right: auto;
        width: min(82vw, 400px);
        height: 260px;
        box-sizing: border-box;
        transform: translateX(-50%) translateY(0); /* align with open state */
        transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease;
        will-change: transform, opacity;
    }
    
    /* Match desktop pop-up behavior on mobile */
    .envelope-wrapper.open .letter {
        position: absolute;
        left: 50%;
        transform: translateX(-50%) translateY(-80px);
        width: min(82vw, 400px);
        height: 260px;
        overflow-y: auto;
        z-index: 700;
        border-radius: 16px;
        padding: 1.1rem;
        box-shadow: 0 30px 60px rgba(0,0,0,0.35);
        background: linear-gradient(180deg, #FFF9FB 0%, #FFF0F3 100%);
    }

    /* Prevent horizontal scrolling on small screens */
    html, body {
        overflow-x: hidden;
    }

    /* When envelope is open, reposition controls and music to avoid covering it */
    body.envelope-open .controls-bar {
        bottom: 1rem !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        top: auto !important;
        right: auto !important;
        opacity: 0.92;
        z-index: 800;
    }

    body.envelope-open .music-player {
        left: 50% !important;
        right: auto !important;
        transform: translateX(-50%) !important;
        bottom: 1rem !important;
        z-index: 800;
    }
    
    .letter-title {
        font-size: 1.4rem;
        margin-bottom: 0.8rem;
    }
    
    .letter-message {
        font-size: 0.95rem;
        line-height: 1.6;
    }
    
    /* Question Card Mobile */
    .question-card {
        padding: 1.2rem 1rem;
        border-radius: 16px;
    }
    
    .question-text {
        font-size: 1.1rem;
        line-height: 1.3;
    }
    
    .button-group {
        gap: 0.8rem;
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 100%;
        max-width: 250px;
        min-height: 48px;
        padding: 1rem 1.5rem;
        font-size: 1rem;
        border-radius: 40px;
    }
    
    /* Controls Bar Mobile */
    .controls-bar {
        position: fixed;
        top: 1rem;
        left: 1rem;
        right: 1rem;
        gap: 0.5rem;
        max-width: calc(100vw - 2rem);
        display: none;
    }
    
    .control-btn {
        padding: 0.6rem 0.8rem;
        font-size: 0.85rem;
        white-space: nowrap;
        min-height: 44px;
        flex: 1;
        max-width: 100%;
    }
    
    .control-btn i {
        display: none;
    }
    
    /* Hamburger Menu Visible on Mobile */
    .hamburger {
        display: flex !important;
    }
    
    .mobile-menu {
        gap: 1rem;
    }
    
    .mobile-menu .control-btn {
        width: 100%;
        max-width: 300px;
        padding: 1rem;
        font-size: 1rem;
        min-height: 48px;
    }
    
    .mobile-menu .control-btn i {
        display: inline;
        margin-right: 0.5rem;
    }
    
    /* Music Player Mobile */
    .music-player {
        display: none;
    }
    
    .music-btn {
        width: 40px;
        height: 40px;
        min-height: 44px;
        min-width: 44px;
    }
    
    .volume-slider {
        display: none;
    }
    
    /* Love Counter Mobile */
    .love-counter {
        position: fixed;
        bottom: calc(1rem + env(safe-area-inset-bottom));
        left: calc(0.6rem + env(safe-area-inset-left));
        font-size: 0.82rem;
        padding: 0.6rem 0.8rem;
        min-height: 44px;
        max-width: 55vw;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* Progress Indicator Mobile */
    .progress-indicator {
        display: none;
    }
    
    .progress-indicator-inner {
        display: none;
    }
    
    .progress-percent {
        display: none;
    }
    
    .progress-label {
        display: none;
    }
    
    /* Undo Button Mobile */
    .undo-btn {
        display: none;
    }
    
    /* Modal Mobile */
    .name-modal-content,
    .gallery-content,
    .editor-content,
    .music-selector-content {
        width: 90vw;
        max-width: 100%;
        padding: 1.5rem;
        margin: 1rem;
        max-height: 80vh;
    }
    
    .name-modal-title,
    .gallery-title,
    .editor-title {
        font-size: 1.3rem;
        margin-bottom: 1rem;
    }
    
    .name-input,
    .editor-textarea {
        padding: 1rem;
        font-size: 1rem;
        min-height: 44px;
    }
    
    .modal-btn {
        min-height: 48px;
        font-size: 1rem;
    }
    
    /* Gallery Mobile */
    .gallery-images {
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 0.8rem;
    }
    
    .gallery-img {
        height: 80px;
    }
    
    /* Toast Mobile */
    .toast-container {
        top: 1rem;
        width: 90%;
        left: 5%;
    }
    
    .toast {
        font-size: 0.9rem;
        padding: 0.8rem 1rem;
    }
    
    /* Celebration Screen Mobile */
    .celebration-title {
        font-size: 2.2rem;
    }
    
    .celebration-message {
        font-size: 1rem;
    }
    
    .celebration-quote {
        font-size: 1rem;
        padding: 1rem;
        min-height: 70px;
    }
    
    .celebration-icon {
        font-size: 4rem;
    }
    
    /* Scroll Behavior */
    html {
        scroll-behavior: smooth;
    }
    
    /* Touch Friendly Spacing */
    .envelope-container {
        padding: 1rem;
    }
    
    .auth-screen {
        padding: 1rem;
    }
}

@media (max-width: 360px) {
    .music-player {
        padding: 0.55rem;
    }
    .love-counter {
        font-size: 0.78rem;
        max-width: 52vw;
    }
}

/* ---------- EXTRA SMALL PHONES (< 480px) ---------- */
@media (max-width: 480px) {
    :root {
        font-size: 13px;
    }
    
    .auth-shell {
        max-width: 95vw;
    }
    
    .auth-hero {
        padding: 1.6rem 1.4rem;
    }
    
    .auth-headline {
        font-size: 1.8rem;
    }
    
    .auth-form {
        padding: 1.6rem 1.4rem;
    }
    
    .pass-input {
        font-size: 1.1rem;
        letter-spacing: 0.3rem;
    }
    
    .envelope {
        width: 100%;
        max-width: 280px;
        height: 200px;
    }
    
    .flap {
        height: 120px;
    }
    
    .letter-title {
        font-size: 1.2rem;
    }
    
    .letter-message {
        font-size: 0.9rem;
    }
    
    .question-card {
        padding: 1rem 0.8rem;
    }
    
    .question-text {
        font-size: 1rem;
    }
    
    .btn {
        font-size: 0.95rem;
        padding: 0.9rem 1.2rem;
    }
    
    .hidden-message {
        padding: 1rem;
    }
    
    .hamburger {
        top: 1rem;
        left: 1rem;
    }
    
    .music-player {
        bottom: 4rem;
        right: 0.8rem;
        padding: 0.6rem;
    }
    
    .progress-indicator {
        width: 70px;
        height: 70px;
        bottom: 3.8rem;
        right: 0.8rem;
    }
    
    .undo-btn {
        bottom: 7.5rem;
        right: 0.8rem;
    }
    
    .love-counter {
        bottom: 0.8rem;
        left: 0.8rem;
        font-size: 0.85rem;
    }
    
    .celebration-title {
        font-size: 1.8rem;
    }
    
    .countdown {
        font-size: 0.85rem;
    }
}

/* ---------- LANDSCAPE ORIENTATION ---------- */
@media (max-height: 600px) and (orientation: landscape) {
    .envelope {
        height: 180px;
    }
    
    .envelope-wrapper.open .letter {
        height: 250px;
        transform: translateX(-50%) translateY(-60px);
    }
    
    .letter-title {
        margin-bottom: 0.5rem;
    }
    
    .question-card {
        padding: 0.8rem 1rem;
    }
    
    .button-group {
        gap: 0.5rem;
    }
    
    .btn {
        padding: 0.8rem 1.2rem;
        font-size: 0.9rem;
    }
}

</style>
</head>
<body>
<!-- CONTROLS BAR -->
<div class="controls-bar">
    <button class="control-btn" id="nameBtn" title="Personalize" aria-label="Personalize"><i class="fas fa-signature"></i> Who's this for?</button>
    <button class="control-btn" id="galleryBtn" title="Add photos" aria-label="Add photos" onclick="document.getElementById('galleryModal').classList.add('show')"><i class="fas fa-images"></i> Photos</button>
    <button class="control-btn" id="themeBtn" title="Change theme" aria-label="Change theme"><i class="fas fa-palette"></i> Theme</button>
    <button class="control-btn" id="shareBtn" title="Share" aria-label="Share"><i class="fas fa-share-alt"></i> Share</button>
    <button class="control-btn" id="printBtn" title="Print" aria-label="Print"><i class="fas fa-print"></i> Print</button>
</div>

<!-- COUNTDOWN TIMER -->
<div class="countdown" id="countdown"></div>

<!-- LOVE COUNTER -->
<div class="love-counter" id="loveCounter">üíî Maybe Later: 0 times</div>

<!-- NAME MODAL -->
<div class="name-modal" id="nameModal">
    <div class="name-modal-content">
        <h2 class="name-modal-title">Who is this Valentine for?</h2>
        <input type="text" class="name-input" id="recipientName" placeholder="Enter their name">
        <button class="modal-btn" id="nameSubmitBtn">Personalize Card</button>
    </div>
</div>

<!-- MUSIC PLAYER -->
<div class="music-player">
    <button class="music-btn" id="musicBtn" title="Toggle music"><i class="fas fa-music"></i></button>
    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="30" title="Volume">
</div>

<!-- LOADING -->
<div class="loading-screen" id="loadingScreen">
    <div class="loader">
        <div class="loader-heart"><i class="fas fa-heart"></i></div>
    </div>
    <div class="loader-text">Preparing something special...</div>
</div>

<!-- AUTH -->
<div class="auth-screen" id="authScreen">
    <div class="auth-shell">
        <div class="auth-hero">
            <span class="auth-kicker"><i class="fas fa-heart"></i> Valentine Access</span>
            <h1 class="auth-headline">Open the Love Letter</h1>
            <p class="auth-copy">Enter the date that started it all in MMDD format. No other key unlocks this note.</p>
            <div class="auth-meta">
                <div class="auth-meta-item"><i class="fas fa-feather"></i> Handwritten message inside</div>
                <div class="auth-meta-item"><i class="fas fa-music"></i> Music stays on your heart</div>
                <div class="auth-meta-item"><i class="fas fa-heart"></i> One-of-one moment</div>
            </div>
            <div class="auth-orbit" aria-hidden="true"></div>
        </div>
        <div class="auth-form">
            <div>
                <div class="auth-form-title">Enter Passcode</div>
                <div class="auth-form-sub">A small secret to unlock a big feeling.</div>
            </div>
            <div class="input-group">
                <label class="input-label" for="passInput">Special date</label>
                <div class="input-wrap">
                    <i class="fas fa-calendar-days" aria-hidden="true"></i>
                    <input type="text" class="pass-input" id="passInput" maxlength="4" placeholder="MMDD" autocomplete="off" aria-label="Enter the special date">
                </div>
            </div>
            <button class="auth-btn" id="unlockBtn" aria-label="Unlock the message">
                <i class="fas fa-key"></i> Unlock My Heart
            </button>
            <div class="error-message" id="errorMessage" aria-live="polite"></div>
            <div class="auth-hint">Hint: two-digit month, two-digit day.</div>
        </div>
    </div>
</div>

<!-- ENVELOPE -->
<div class="envelope-container" id="envelopeContainer">
    <div class="envelope-wrapper" id="envelopeWrapper">
        <div class="envelope">
            <div class="flap"></div>
            <div class="seal" id="envelopeSeal" aria-hidden="true">
                <div class="seal-inner">‚ù§Ô∏è</div>
            </div>
            <div class="letter">
                <div class="letter-content">
                    <h2 class="letter-title" id="letterTitle"></h2>
                    <p class="letter-message" id="letterMessage"></p>
                    <div class="question-zone" id="questionZone">
                        <div class="question-card">
                            <p class="question-text">Will you make me the happiest person this Valentine's Day?</p>
                            <div class="button-group">
                                <button class="btn btn-yes" id="yesBtn">
                                    <i class="fas fa-heart"></i> Yes, Absolutely!
                                </button>
                                <button class="btn btn-no" id="noBtn">
                                    <i class="fas fa-times"></i> Maybe Later
                                </button>
                            </div>
                        </div>
                        <div class="hidden-message" id="hiddenMessage">
                            <div class="hidden-message-title">üíù For Your Eyes Only</div>
                            <div class="hidden-message-text">If you said yes, here's a little something extra just for you... You are the best thing that's ever happened to me. Every moment with you is a treasure. Can't wait to make countless more memories together. Forever yours. üíï</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- CELEBRATION -->
<div class="celebration-screen" id="celebrationScreen">
    <div class="celebration-content">
        <div class="celebration-icon"><i class="fas fa-heart-circle-check"></i></div>
        <h1 class="celebration-title">It's a Date! üíñ</h1>
        <div class="celebration-photo-slideshow" id="photoSlideshow"></div>
        <p class="celebration-message">My heart is doing somersaults! I can't wait to spend Valentine's Day with you. Get ready for the most memorable day of our lives.</p>
        <div class="celebration-quote" id="celebrationQuote"></div>
        <div class="celebration-date">February 14th</div>
    </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- GALLERY MODAL -->
<div class="gallery-modal" id="galleryModal">
    <div class="gallery-content">
        <h2 class="gallery-title">Add Your Photos</h2>
        <div class="gallery-upload" id="galleryUpload">
            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 1rem;"></i>
            <p>Click to upload or drag photos</p>
            <input type="file" id="photoInput" accept="image/*" multiple>
        </div>
        <div class="gallery-images" id="galleryImages"></div>
        <button class="modal-btn" style="margin-top: 1.5rem;" onclick="document.getElementById('galleryModal').classList.remove('show')">Close</button>
    </div>
</div>

<!-- MESSAGE EDITOR MODAL -->
<div class="editor-modal" id="editorModal">
    <div class="editor-content">
        <h2 class="editor-title">Edit Your Message</h2>
        <textarea class="editor-textarea" id="messageEditor" placeholder="Write your custom message..."></textarea>
        <button class="modal-btn" id="saveMessageBtn">Save Message</button>
        <button class="modal-btn" style="margin-top: 0.5rem; background: rgba(255,255,255,0.1);" onclick="document.getElementById('editorModal').classList.remove('show')">Cancel</button>
    </div>
</div>

<!-- MUSIC SELECTOR -->
<div class="music-selector" id="musicSelector">
    <div class="music-selector-content">
        <h2 class="music-option" style="margin-bottom: 1.5rem; cursor: default;">Choose Background Music</h2>
        <div class="music-option active" data-music="romantic">
            <i class="fas fa-music"></i> Romantic Dream
        </div>
        <div class="music-option" data-music="piano">
            <i class="fas fa-music"></i> Piano Love
        </div>
        <div class="music-option" data-music="acoustic">
            <i class="fas fa-music"></i> Acoustic Vibes
        </div>
        <button class="modal-btn" onclick="document.getElementById('musicSelector').classList.remove('show')">Done</button>
    </div>
</div>

<!-- HAMBURGER MENU -->
<button class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
</button>

<!-- MOBILE MENU -->
<div class="mobile-menu" id="mobileMenu">
    <button class="control-btn" onclick="document.getElementById('nameModal').classList.add('show')"><i class="fas fa-signature"></i> Personalize</button>
    <button class="control-btn" onclick="document.getElementById('editorModal').classList.add('show')"><i class="fas fa-pen"></i> Edit Message</button>
    <button class="control-btn" onclick="document.getElementById('galleryModal').classList.add('show')"><i class="fas fa-images"></i> Add Photos</button>
    <button class="control-btn" onclick="document.getElementById('musicSelector').classList.add('show')"><i class="fas fa-music"></i> Music</button>
    <button class="control-btn" id="themeBtn2"><i class="fas fa-palette"></i> Theme</button>
    <button class="control-btn" id="shareBtn2"><i class="fas fa-share-alt"></i> Share</button>
    <button class="control-btn" id="printBtn2"><i class="fas fa-print"></i> Print</button>
</div>

<!-- MUSIC -->
<audio id="backgroundMusic" loop>
    <source src="https://assets.mixkit.co/music/preview/mixkit-romantic-dream-3325.mp3" type="audio/mpeg">
</audio>

<script>
// --- CONFIG ---
const CONFIG = {
    SPECIAL_DATE: "0214",
    TITLE: "My Favorite Person üíï",
    MESSAGE: "From the moment we met, the days got softer and brighter, like the sun decided to show up early just for us. Your smile is my favorite sunrise, your laugh my favorite song, and your hugs the place my worries go to take a nap. I've been collecting our moments like little love notes tucked in a pocket, and I have something important to ask you... You make ordinary things feel like magic: grocery aisles, bad weather, even my messy hair days. I love you love, in a thousand small ways and one very big one. I choose you in the tiny moments and the epic ones, in every season and every silly pun. So tell me, will you be my forever favorite and make this Valentine's Day the start of even more beautiful memories together?",
    IMAGES: [],
    QUOTES: [
        "Every moment with you is a treasure I'll cherish forever. üíï",
        "You are my greatest adventure and my safe haven. üåπ",
        "In your eyes, I found my home, my peace, and my love. üí´",
        "You make my heart skip a beat every single day. üíñ",
        "Forever isn't long enough to love you. üíù",
        "You're not just my love, you're my best friend. üëë",
        "Every love story is beautiful, but ours is my favorite. ‚ú®",
        "With you, I found what my soul was searching for. üé≠",
        "You're the reason I believe in true love. üíï",
        "My heart knew you before my mind caught up. üíò",
        "You are my greatest blessing and answered prayer. üôè",
        "In a world full of people, you're my person. üíë",
        "You make every day feel like a beautiful dream. üåü",
        "I choose you, yesterday, today, and forever. üóìÔ∏è",
        "Your love is the greatest gift I could ever receive. üéÅ",
        "You are my sunshine on the darkest days. ‚òÄÔ∏è",
        "Together with you feels like coming home. üè°",
        "My love for you grows deeper with each passing moment. üìà",
        "You're the missing piece my heart was looking for. üß©",
        "Forever starts with you. üåÖ"
    ]
};

// Preload images
CONFIG.IMAGES.forEach(src => {
    const img = new Image();
    img.src = src;
});

// Audio context helper (reuse a single AudioContext to avoid resource leaks)
let _audioCtx = null;
function getAudioCtx() {
    if (!_audioCtx) _audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    return _audioCtx;
} 

// --- STATE ---
const AppState = {
    currentScreen: 'loading',
    isEnvelopeOpen: false,
    isCelebrating: false,
    currentImageIndex: 0,
    recipientName: 'My Love',
    currentTheme: 'default',
    customMessage: false,
    intervals: {
        images: null,
        particles: null,
        countdown: null,
        quotes: null
    },
    buttonScale: {
        noPresses: 0,
        noScale: 1,
        yesScale: 1
    }
};

// --- DOM ---
const elements = {
    loadingScreen: document.getElementById('loadingScreen'),
    authScreen: document.getElementById('authScreen'),
    envelopeContainer: document.getElementById('envelopeContainer'),
    envelopeWrapper: document.getElementById('envelopeWrapper'),
    celebrationScreen: document.getElementById('celebrationScreen'),
    passInput: document.getElementById('passInput'),
    unlockBtn: document.getElementById('unlockBtn'),
    errorMessage: document.getElementById('errorMessage'),
    letterTitle: document.getElementById('letterTitle'),
    letterMessage: document.getElementById('letterMessage'),
    letterContent: document.querySelector('.letter-content'),
    questionZone: document.getElementById('questionZone'),
    yesBtn: document.getElementById('yesBtn'),
    noBtn: document.getElementById('noBtn'),
    backgroundMusic: document.getElementById('backgroundMusic'),
    nameModal: document.getElementById('nameModal'),
    recipientName: document.getElementById('recipientName'),
    nameSubmitBtn: document.getElementById('nameSubmitBtn'),
    nameBtn: document.getElementById('nameBtn'),
    themeBtn: document.getElementById('themeBtn'),
    shareBtn: document.getElementById('shareBtn'),
    printBtn: document.getElementById('printBtn'),
    musicBtn: document.getElementById('musicBtn'),
    volumeSlider: document.getElementById('volumeSlider'),
    loveCounter: document.getElementById('loveCounter'),
    countdown: document.getElementById('countdown'),
    hiddenMessage: document.getElementById('hiddenMessage')
};

// --- INIT ---
document.addEventListener('DOMContentLoaded', () => {
    // Show loading screen for 2.5 seconds
    setTimeout(() => {
        elements.loadingScreen.classList.add('hidden');
        setTimeout(() => {
            elements.loadingScreen.style.display = 'none';
            showAuthScreen();
        }, 800);
    }, 2500);

    // Event listeners
    elements.unlockBtn.addEventListener('click', unlockApp);
    elements.passInput.addEventListener('keypress', e => {
        if (e.key === 'Enter') unlockApp();
    });
    elements.envelopeWrapper.addEventListener('click', openEnvelope);
    elements.yesBtn.addEventListener('click', celebrate);
    elements.noBtn.addEventListener('click', shrinkNoButton);
    elements.nameBtn.addEventListener('click', () => elements.nameModal.classList.add('show'));
    elements.nameSubmitBtn.addEventListener('click', setRecipientName);
    elements.recipientName.addEventListener('keypress', e => {
        if (e.key === 'Enter') setRecipientName();
    });
    elements.themeBtn.addEventListener('click', cycleTheme);
    elements.shareBtn.addEventListener('click', shareCard);
    elements.printBtn.addEventListener('click', () => window.print());
    elements.musicBtn.addEventListener('click', toggleMusic);
    elements.volumeSlider.addEventListener('input', changeVolume);
    elements.volumeSlider.addEventListener('change', changeVolume);
    
    // Close modal on background click
    elements.nameModal.addEventListener('click', e => {
        if (e.target === elements.nameModal) {
            elements.nameModal.classList.remove('show');
        }
    });
    
    // New feature event listeners
    document.getElementById('galleryUpload').addEventListener('click', () => {
        document.getElementById('photoInput').click();
    });
    document.getElementById('photoInput').addEventListener('change', handlePhotoUpload);
    document.getElementById('saveMessageBtn').addEventListener('click', saveCustomMessage);
    document.getElementById('hamburger').addEventListener('click', toggleMobileMenu);
    document.querySelectorAll('.music-option:not(:first-child)').forEach(opt => {
        opt.addEventListener('click', () => changeMusicTrack(opt.dataset.music));
    });
    
    // Add ripple effect to all buttons
    document.querySelectorAll('.btn, .modal-btn, .control-btn, .music-btn').forEach(btn => {
        btn.addEventListener('click', createRipple);
    });
    
    // Mouse move for sparkles
    document.addEventListener('mousemove', createSparkleAtMouse);
    
    // Create floating hearts
    createFloatingHearts();
    startCountdown();
    
    // Keyboard Easter eggs
    setupKeyboardShortcuts();
    
    // Load saved data from localStorage
    loadLocalStorage();
});

// --- SCREEN MANAGEMENT ---
function showAuthScreen() {
    AppState.currentScreen = 'auth';
    // Ensure envelope is hidden when showing auth
    elements.envelopeContainer.classList.remove('visible');
    document.body.classList.remove('envelope-open');
    document.body.classList.remove('approved');
    document.body.classList.add('auth-open');
    elements.authScreen.style.display = 'flex';
    setTimeout(() => {
        elements.authScreen.style.opacity = '1';
    }, 10);
    elements.passInput.focus();
}  

function showEnvelopeScreen() {
    AppState.currentScreen = 'envelope';
    elements.authScreen.style.display = 'none';
    // Use a visible class so CSS controls display instead of forcing it in JS
    elements.envelopeContainer.classList.add('visible');
    document.body.classList.add('envelope-open');
    document.body.classList.remove('auth-open');
    document.body.classList.add('approved');
    resetLetterContent();
    startParticles();
}  

function showCelebrationScreen() {
    AppState.currentScreen = 'celebration';
    AppState.isCelebrating = true;
    stopParticles();
    clearInterval(AppState.intervals.images);
    // Hide envelope by removing the visible class
    elements.envelopeContainer.classList.remove('visible');
    document.body.classList.remove('envelope-open');
    document.body.classList.remove('auth-open');
    elements.celebrationScreen.style.display = 'flex';
    setTimeout(() => {
        elements.celebrationScreen.style.opacity = '1';
    }, 10);
    startHeartRain();
    startPhotoSlideshow();
    startQuoteRotation();
    
    // Play music if not already playing
    if (elements.backgroundMusic.paused) {
        applyVolumeFromSlider();
        elements.backgroundMusic.play().catch(() => {});
    }
}

// --- AUTH FUNCTION ---
function unlockApp() {
    const input = elements.passInput.value.trim();
    
    if (input === CONFIG.SPECIAL_DATE) {
        elements.errorMessage.textContent = '';
        elements.passInput.style.borderColor = '#4CC9F0';
        setTimeout(() => {
            showEnvelopeScreen();
            applyVolumeFromSlider();
            elements.backgroundMusic.play().catch(() => {});
        }, 600);
    } else {
        elements.errorMessage.textContent = "That's not our special date! Try again üíñ";
        elements.errorMessage.classList.add('show');
        elements.passInput.classList.add('shake');
        setTimeout(() => {
            elements.passInput.classList.remove('shake');
        }, 500);
        elements.passInput.value = '';
        elements.passInput.focus();
    }
}

// --- ENVELOPE FUNCTIONS ---
function openEnvelope() {
    if (AppState.isEnvelopeOpen) return;
    AppState.isEnvelopeOpen = true;
    elements.envelopeWrapper.classList.add('open');
    setTimeout(() => {
        startLetterReveal();
    }, 350);
}

// --- TYPING EFFECT ---
function resetLetterContent() {
    elements.letterTitle.textContent = '';
    elements.letterMessage.textContent = '';
    elements.questionZone.style.display = 'none';
    if (elements.letterContent) {
        elements.letterContent.scrollTop = 0;
    }
}

function startLetterReveal() {
    resetLetterContent();
    typewriteMessage(() => {
        elements.questionZone.style.display = 'block';
        unlockLetterScroll();
    });
    lockLetterScroll();
}

function lockLetterScroll() {
    if (!elements.letterContent) return;
    elements.letterContent.style.overflowY = 'hidden';
}

function unlockLetterScroll() {
    if (!elements.letterContent) return;
    elements.letterContent.style.overflowY = 'auto';
}

function autoScrollLetter() {
    if (!elements.letterContent) return;
    elements.letterContent.scrollTop = elements.letterContent.scrollHeight;
}

function typewriteMessage(onDone) {
    const TITLE_SPEED = 40;
    const MESSAGE_SPEED = 55;
    let titleIndex = 0;
    let messageIndex = 0;
    
    function typeTitle() {
        if (titleIndex < CONFIG.TITLE.length) {
            elements.letterTitle.textContent += CONFIG.TITLE.charAt(titleIndex);
            autoScrollLetter();
            titleIndex++;
            setTimeout(typeTitle, TITLE_SPEED);
        } else {
            typeMessage();
        }
    }
    
    function typeMessage() {
        if (messageIndex < CONFIG.MESSAGE.length) {
            elements.letterMessage.textContent += CONFIG.MESSAGE.charAt(messageIndex);
            autoScrollLetter();
            messageIndex++;
            setTimeout(typeMessage, MESSAGE_SPEED);
        } else if (typeof onDone === 'function') {
            onDone();
        }
    }
    
    typeTitle();
}

// --- BUTTON FUNCTIONS ---
function shrinkNoButton() {
    if (AppState.isCelebrating) return;

    AppState.buttonScale.noPresses++;
    AppState.buttonScale.noScale = Math.max(0.3, 1 - AppState.buttonScale.noPresses * 0.15);
    AppState.buttonScale.yesScale = 1 + AppState.buttonScale.noPresses * 0.15;

    // Scale visually without changing layout to keep envelope size stable
    elements.noBtn.style.setProperty('--btn-scale', AppState.buttonScale.noScale.toFixed(2));
    elements.yesBtn.style.setProperty('--btn-scale', AppState.buttonScale.yesScale.toFixed(2));
}


function celebrate() {
    if (AppState.isCelebrating) return;
    showCelebrationScreen();
}

// --- VISUAL EFFECTS ---
function createFloatingHearts() {
    for (let i = 0; i < 15; i++) {
        setTimeout(() => {
            const heart = document.createElement('div');
            heart.className = 'floating-heart';
            heart.innerHTML = 'üíñ';
            heart.style.left = `${Math.random() * 100}vw`;
            heart.style.top = `${Math.random() * 100}vh`;
            heart.style.fontSize = `${Math.random() * 20 + 15}px`;
            const duration = Math.random() * 20 + 15; // seconds
            heart.style.animationDuration = `${duration}s`;
            heart.style.opacity = Math.random() * 0.5 + 0.3;
            document.body.appendChild(heart);

            // Remove heart after its animation completes to avoid DOM buildup
            setTimeout(() => {
                heart.remove();
            }, (duration * 1000) + 5000);
        }, i * 300);
    }
} 

function startParticles() {
    AppState.intervals.particles = setInterval(createParticle, 500);
}

function stopParticles() {
    if (AppState.intervals.particles) {
        clearInterval(AppState.intervals.particles);
    }
}

function createParticle() {
    const particle = document.createElement('div');
    particle.className = 'heart-particle';
    particle.innerHTML = 'üå∏';
    particle.style.left = `${Math.random() * 100}vw`;
    particle.style.fontSize = `${Math.random() * 20 + 10}px`;
    document.body.appendChild(particle);
    
    setTimeout(() => {
        particle.remove();
    }, 4000);
}

function startHeartRain() {
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const particle = document.createElement('div');
            particle.className = 'heart-particle';
            particle.innerHTML = 'üíñ';
            particle.style.left = `${Math.random() * 100}vw`;
            particle.style.fontSize = `${Math.random() * 30 + 15}px`;
            document.body.appendChild(particle);
            
            setTimeout(() => {
                particle.remove();
            }, 6000);
        }, i * 200);
    }
}

function startPhotoSlideshow() {
    const slideshowContainer = document.getElementById('photoSlideshow');
    if (!CONFIG.IMAGES || CONFIG.IMAGES.length === 0) {
        slideshowContainer.classList.remove('show');
        return;
    }
    
    slideshowContainer.classList.add('show');
    let currentIndex = 0;
    
    function showPhoto(index) {
        slideshowContainer.innerHTML = `<img src="${CONFIG.IMAGES[index]}" alt="Memory ${index + 1}">`;
    }
    
    showPhoto(0);
    
    if (CONFIG.IMAGES.length > 1) {
        AppState.intervals.images = setInterval(() => {
            currentIndex = (currentIndex + 1) % CONFIG.IMAGES.length;
            showPhoto(currentIndex);
        }, 3000);
    }
}

function startQuoteRotation() {
    const quoteElement = document.getElementById('celebrationQuote');
    let currentQuoteIndex = 0;
    
    function showQuote(index) {
        quoteElement.textContent = CONFIG.QUOTES[index];
    }
    
    showQuote(0);
    
    AppState.intervals.quotes = setInterval(() => {
        currentQuoteIndex = (currentQuoteIndex + 1) % CONFIG.QUOTES.length;
        showQuote(currentQuoteIndex);
    }, 5000);
}

// --- NEW FEATURES ---

function setRecipientName() {
    const name = elements.recipientName.value.trim();
    if (name) {
        AppState.recipientName = name;
        elements.nameModal.classList.remove('show');
        elements.letterTitle.textContent = `To ${name} üíï`;
        playSound('success');
    }
}

function cycleTheme() {
    const themes = ['default', 'theme-pastel', 'theme-dark'];
    const currentIdx = themes.indexOf(AppState.currentTheme);
    const nextTheme = themes[(currentIdx + 1) % themes.length];
    AppState.currentTheme = nextTheme;
    document.documentElement.className = nextTheme === 'default' ? '' : nextTheme;
    playSound('click');
}

function shareCard() {
    const text = `Check out this special Valentine's card! üíå`;
    const url = window.location.href;
    
    if (navigator.share) {
        navigator.share({
            title: 'Valentine Card',
            text: text,
            url: url
        }).catch(err => console.log('Share failed:', err));
    } else {
        // Fallback: copy to clipboard
        const fullText = `${text}\n${url}`;
        navigator.clipboard.writeText(fullText).then(() => {
            alert('Link copied to clipboard! Share it with your special someone üíï');
        });
    }
    playSound('success');
}

function toggleMusic() {
    if (elements.backgroundMusic.paused) {
        applyVolumeFromSlider();
        elements.backgroundMusic.play();
        elements.musicBtn.style.color = '#4CC9F0';
        playSound('click');
    } else {
        elements.backgroundMusic.pause();
        elements.musicBtn.style.color = 'white';
    }
}

function changeVolume(e) {
    const value = Number(e.target.value) / 100;
    elements.backgroundMusic.volume = Math.min(1, Math.max(0, value));
    elements.backgroundMusic.muted = value === 0;
}

function applyVolumeFromSlider() {
    const value = Number(elements.volumeSlider.value) / 100;
    elements.backgroundMusic.volume = Math.min(1, Math.max(0, value));
    elements.backgroundMusic.muted = value === 0;
}

function startCountdown() {
    function updateCountdown() {
        const now = new Date();
        const currentYear = now.getFullYear();
        const valentinesDay = new Date(currentYear, 1, 14, 0, 0, 0); // Feb 14, 00:00:00
        
        // If Valentine's Day has passed this year, set target to next year
        if (now > valentinesDay) {
            valentinesDay.setFullYear(currentYear + 1);
        }
        
        const diff = valentinesDay - now;
        
        if (diff <= 0) {
            elements.countdown.innerHTML = `<span class="countdown-number">Happy Valentine's Day! üíï</span>`;
            return;
        }
        
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        elements.countdown.innerHTML = `<span class="countdown-number">${String(days).padStart(2, '0')} : ${String(hours).padStart(2, '0')} : ${String(minutes).padStart(2, '0')} : ${String(seconds).padStart(2, '0')}</span><br><span style="font-size:0.8em;color:rgba(255,255,255,0.7);">Days : Hours : Minutes : Seconds</span>`;
    }
    
    updateCountdown();
    AppState.intervals.countdown = setInterval(updateCountdown, 1000);
}

function updateLoveCounter() {
    elements.loveCounter.textContent = `üíî Maybe Later: ${AppState.buttonScale.noPresses} times`;
    playSound('click');
}

function burstConfetti() {
    const colors = ['üíï', 'üéÄ', '‚ú®', 'üíñ', 'üåπ'];
    for (let i = 0; i < 30; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.innerHTML = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = '-50px';
            confetti.style.fontSize = Math.random() * 30 + 20 + 'px';
            document.body.appendChild(confetti);
            
            setTimeout(() => confetti.remove(), 3000);
        }, i * 30);
    }
}

function playSound(type) {
    // Reuse a single AudioContext to avoid creating many (which can exhaust system resources)
    try {
        const audioContext = getAudioCtx();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        if (type === 'success') {
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0, audioContext.currentTime + 0.25);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.25);
        } else if (type === 'click') {
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0, audioContext.currentTime + 0.12);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.12);
        }
    } catch (err) {
        // Fallback silently if audio context cannot be created
        console.error('Audio not available:', err);
    }
} 

function setupKeyboardShortcuts() {
    document.addEventListener('keydown', e => {
        // Konami code: up up down down left right left right b a
        if (e.key === '?') {
            alert('üéâ Easter Egg Unlocked! üéâ\nYou found the secret shortcut!\nMake sure to tell your Valentine how special they are. üíï');
            burstConfetti();
            playSound('success');
        }
    });
}

// Update shrinkNoButton to show love counter
const originalShrinkNoButton = shrinkNoButton;
function shrinkNoButton() {
    if (AppState.isCelebrating) return;

    AppState.buttonScale.noPresses++;
    AppState.buttonScale.noScale = Math.max(0.3, 1 - AppState.buttonScale.noPresses * 0.15);
    AppState.buttonScale.yesScale = 1 + AppState.buttonScale.noPresses * 0.15;

    // Shrink "No" button
    const noScaleFactor = AppState.buttonScale.noScale;
    elements.noBtn.style.padding = `${0.9 * noScaleFactor}rem ${1.6 * noScaleFactor}rem`;
    elements.noBtn.style.fontSize = `${1.1 * noScaleFactor}rem`;
    elements.noBtn.style.minWidth = `${140 * noScaleFactor}px`;

    // Grow "Yes" button
    const yesScaleFactor = AppState.buttonScale.yesScale;
    elements.yesBtn.style.padding = `${1 * yesScaleFactor}rem ${2 * yesScaleFactor}rem`;
    elements.yesBtn.style.fontSize = `${1.1 * yesScaleFactor}rem`;
    elements.yesBtn.style.minWidth = `${160 * yesScaleFactor}px`;
    
    updateLoveCounter();
}

// Update celebrate to show hidden message and confetti
const originalCelebrate = celebrate;
function celebrate() {
    if (AppState.isCelebrating) return;
    
    // Show hidden message first
    elements.hiddenMessage.classList.add('show');
    
    // Burst confetti
    burstConfetti();
    playSound('success');
    
    // Then show celebration screen
    setTimeout(() => {
        showCelebrationScreen();
    }, 500);
}

// ---------- RIPPLE EFFECT ----------
function createRipple(e) {
    const button = e.currentTarget;
    const ripple = document.createElement('div');
    ripple.classList.add('ripple');
    
    const rect = button.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    const x = e.clientX - rect.left - size / 2;
    const y = e.clientY - rect.top - size / 2;
    
    ripple.style.width = ripple.style.height = size + 'px';
    ripple.style.left = x + 'px';
    ripple.style.top = y + 'px';
    
    button.appendChild(ripple);
    setTimeout(() => ripple.remove(), 600);
}

// ---------- TOAST NOTIFICATIONS ----------
function showToast(message, type = 'success') {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = message;
    
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ---------- SPARKLES CURSOR ----------
let lastSparkleTime = 0;
function createSparkleAtMouse(e) {
    if (Date.now() - lastSparkleTime < 100) return;
    lastSparkleTime = Date.now();
    
    const sparkle = document.createElement('div');
    sparkle.classList.add('sparkle');
    sparkle.innerHTML = ['‚ú®', 'üí´', '‚≠ê'][Math.floor(Math.random() * 3)];
    sparkle.style.left = e.clientX + 'px';
    sparkle.style.top = e.clientY + 'px';
    
    const tx = (Math.random() - 0.5) * 100;
    const ty = (Math.random() - 0.5) * 100;
    sparkle.style.setProperty('--tx', tx + 'px');
    sparkle.style.setProperty('--ty', ty + 'px');
    
    document.body.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 1000);
}

// ---------- PHOTO GALLERY ----------
function handlePhotoUpload(e) {
    const files = Array.from(e.target.files);
    const galleryImages = document.getElementById('galleryImages');
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB per image
    const MAX_IMAGES = 30;
    let added = 0;

    files.forEach(file => {
        if (!file.type || !file.type.startsWith('image/')) {
            showToast('‚ö†Ô∏è Only image files are allowed.');
            return;
        }
        if (file.size > MAX_FILE_SIZE) {
            showToast('‚ö†Ô∏è One photo exceeds the 5MB limit and was skipped.');
            return;
        }
        if (CONFIG.IMAGES.length >= MAX_IMAGES) {
            showToast('‚ö†Ô∏è Image limit reached (30).');
            return;
        }

        const reader = new FileReader();
        reader.onload = (event) => {
            // Automatically add to slideshow
            CONFIG.IMAGES.push(event.target.result);
            added++;

            // Also show as thumbnail in gallery
            const img = document.createElement('img');
            img.src = event.target.result;
            img.className = 'gallery-img';
            img.title = 'Added to slideshow ‚úì';
            img.onclick = () => {
                showToast('‚úì Photo already in slideshow!');
            };
            galleryImages.appendChild(img);
        };
        reader.readAsDataURL(file);
    });

    if (added > 0) showToast(`üì∏ ${added} photo(s) added to slideshow!`);
} 

// ---------- MESSAGE EDITOR ----------
function saveCustomMessage() {
    const customMsg = document.getElementById('messageEditor').value.trim();
    if (customMsg) {
        CONFIG.MESSAGE = customMsg;
        AppState.customMessage = true;
        elements.letterMessage.textContent = customMsg;
        document.getElementById('editorModal').classList.remove('show');
        showToast('‚úçÔ∏è Message updated!');
        saveLocalStorage();
    }
}

// ---------- MOBILE MENU ----------
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    const hamburger = document.getElementById('hamburger');
    menu.classList.toggle('show');
    hamburger.classList.toggle('active');
}

// ---------- MUSIC SELECTOR ----------
function changeMusicTrack(track) {
    const tracks = {
        romantic: 'https://assets.mixkit.co/music/preview/mixkit-romantic-dream-3325.mp3',
        piano: 'https://assets.mixkit.co/music/preview/mixkit-pianist-1001.mp3',
        acoustic: 'https://assets.mixkit.co/music/preview/mixkit-acoustic-night-588.mp3'
    };
    
    elements.backgroundMusic.src = tracks[track] || tracks.romantic;
    document.querySelectorAll('.music-option').forEach(opt => {
        opt.classList.toggle('active', opt.dataset.music === track);
    });
    showToast('üéµ Music changed!');
    saveLocalStorage();
}

// ---------- UNDO BUTTON ----------
function undoMaybeLatersClicks() {
    AppState.buttonScale.noPresses = 0;
    AppState.buttonScale.noScale = 1;
    AppState.buttonScale.yesScale = 1;
    
    elements.noBtn.style.setProperty('--btn-scale', '1');
    elements.yesBtn.style.setProperty('--btn-scale', '1');
    
    elements.loveCounter.textContent = 'üíî Maybe Later: 0 times';
    showToast('‚Ü©Ô∏è Reset to fresh start!');
    saveLocalStorage();
}

// ---------- LOCAL STORAGE ----------
function saveLocalStorage() {
    const data = {
        recipientName: AppState.recipientName,
        noPresses: AppState.buttonScale.noPresses,
        theme: AppState.currentTheme,
        message: CONFIG.MESSAGE,
        messageCustom: AppState.customMessage
    };
    localStorage.setItem('valentineCardData', JSON.stringify(data));
}

function loadLocalStorage() {
    const saved = localStorage.getItem('valentineCardData');
    if (saved) {
        const data = JSON.parse(saved);
        AppState.recipientName = data.recipientName || 'My Love';
        AppState.currentTheme = data.theme || 'default';
        AppState.customMessage = data.messageCustom || false;
        if (AppState.customMessage && data.message) {
            CONFIG.MESSAGE = data.message;
        }
        AppState.buttonScale.noPresses = data.noPresses || 0;
        
        if (AppState.currentTheme !== 'default') {
            document.documentElement.className = AppState.currentTheme;
        }
        
        updateLoveCounter();
    }
}

// ---------- KEYBOARD NAVIGATION ----------
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
        document.getElementById('nameModal').classList.remove('show');
        document.getElementById('galleryModal').classList.remove('show');
        document.getElementById('editorModal').classList.remove('show');
        document.getElementById('musicSelector').classList.remove('show');
        document.getElementById('mobileMenu').classList.remove('show');
        document.getElementById('hamburger').classList.remove('active');
    }
    // '?' shortcut handled in setupKeyboardShortcuts() to avoid duplicate side-effects
    if (e.ctrlKey && e.key === 'z') {
        undoMaybeLatersClicks();
    }
});

// Close modals on background click
[document.getElementById('galleryModal'), document.getElementById('editorModal'), document.getElementById('musicSelector')].forEach(modal => {
    modal?.addEventListener('click', e => {
        if (e.target === modal) modal.classList.remove('show');
    });
});

// ---------- MOBILE OPTIMIZATION ----------
function initMobileOptimizations() {
    // Detect if mobile
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    const isSmallScreen = window.innerWidth < 768;
    
    if (isMobile || isSmallScreen) {
        // Add viewport height fix for mobile browsers
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', vh + 'px');
        
        // Recalculate on orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                const newVh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', newVh + 'px');
            }, 100);
        });
        
        // Prevent zoom on input focus
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            input.addEventListener('focus', () => {
                document.body.style.zoom = '1';
            });
        });
        
        // Touch-friendly enhancements
        document.addEventListener('touchstart', function() {}, {passive: true});
        
        // Swipe to open envelope on mobile
        let touchStartX = 0;
        let touchStartY = 0;
        
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, {passive: true});
        
        document.addEventListener('touchend', e => {
            if (!AppState.isEnvelopeOpen && AppState.currentScreen === 'envelope') {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = Math.abs(touchEndX - touchStartX);
                const diffY = Math.abs(touchEndY - touchStartY);
                
                // If swipe down and minimal horizontal movement, open envelope
                if (diffY > 50 && diffX < 50) {
                    if (touchEndY > touchStartY) {
                        openEnvelope();
                    }
                }
            }
        }, {passive: true});
    }
    
    // Adjust button sizes for touch
    if (isMobile || isSmallScreen) {
        document.querySelectorAll('button').forEach(btn => {
            const currentHeight = btn.offsetHeight;
            if (currentHeight < 44) {
                btn.style.minHeight = '44px';
                btn.style.padding = '12px 16px';
            }
        });
    }
}

// Close mobile menu when clicking outside
document.addEventListener('click', e => {
    const menu = document.getElementById('mobileMenu');
    const hamburger = document.getElementById('hamburger');
    if (!menu.contains(e.target) && !hamburger.contains(e.target) && menu.classList.contains('show')) {
        menu.classList.remove('show');
        hamburger.classList.remove('active');
    }
});

// Initialize mobile optimizations when DOM is ready
document.addEventListener('DOMContentLoaded', initMobileOptimizations);

// Handle window resize
window.addEventListener('resize', () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', vh + 'px');
});

// Cleanup intervals and audio on unload
window.addEventListener('beforeunload', () => {
    Object.values(AppState.intervals).forEach(id => { if (id) clearInterval(id); });
    if (_audioCtx && typeof _audioCtx.close === 'function') _audioCtx.close();
});
</script>
</body>
</html>
